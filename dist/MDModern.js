!function(e,t,n,s,i){"use strict";function o(){return V?!1:(V=!0,c("locked"),!0)}function r(){return V?(V=!1,c("unlocked"),!0):!1}function l(e){s.log("MDM: sending username"),alert("USER###"+e)}function a(e){s.log("MDM: sending password"),W=!1,alert("LOGIN###"+e)}function c(e,t){s.log("EVENT: "+e,t),R.triggerHandler(e,t)}function d(e,t,n,s){this.name=e,this.gecos=t,this.loggedIn=n||!1,this.facefile=s||"file:///home/"+e+"/.face"}function u(e,t){this.name=e,this.file=t}function h(e,t){this.name=e,this.code=t}function f(e,t){if(t){var s=n('<li class="message">'+t+"</li>");X.append(s.fadeIn()).animate({scrollTop:X.height()},500)}}function g(e,t){K.text(t)}function m(e,t){t>Z&&(Z=t,Y.addClass("running")),Y.css({width:100*t/Z+"%"})}function p(e){e.preventDefault(),z.login(se[0].value,ie[0].value),ie.select()}function v(e,t){var s=n("<li>"),i=n("<a>"+t.name+"</a>"),o=n('<i class="fa fa-user">'),r=new Image;ae.append(s.append(i.prepend(o))),t.loggedIn&&s.addClass("loggedIn"),i.click(function(e){w(e,t)}),r.loaded=!1,r.src=t.facefile,n(r).one("load",function(){o.remove(),i.prepend(r),r.loaded=!0}),t.$li=s,t.img=r,re.push(t),1===re.length&&le.one("click",_),ee||(ee=t)}function w(e,t){ee.$li.removeClass("selected"),y(t),t&&t.$li&&(se.is(e.target)||t.name===se[0].value||se.val(t.name),t.$li&&t.$li.addClass("selected"),ee=t)}function y(e){ne.removeClass("hasface"),e&&e.img&&(e.img.loaded?(oe.src=e.img.src,ne.addClass("hasface")):n(e.img).one("load",function(){e==ee&&(oe.src=e.img.src),ne.addClass("hasface")}))}function _(e){ce?(te.off("click",_),le.one("click",_)):(te.click(_),e.stopPropagation()),ae.toggleClass("expanded"),ce=!ce}function C(e,t){t.$li=n(document.createElement("li")).append(n("<a>"+t.name+"</a>").click(t.select.bind(t))),he.append(t.$li),de||(de=t)}function S(e,t){de.$li.removeClass("selected"),ue.html(t.name),t.$li.addClass("selected"),de=t}function E(e,t){t.$li=n(document.createElement("li")).append(n('<a><span class="code">'+t.countryCode()+'</span><span class="name">'+t.name+"</span></a>").click(t.select.bind(t))),me.append(t.li),fe||(fe=t)}function I(e,t){fe.$li.removeClass("selected"),ge.html(t.shortCode()),t.$li.addClass("selected"),fe=t}function b(e,t,n){if(e in ve)return ve[e];if("boolean"==typeof t&&(n=t,t=T),n=pe&&(n===T||n),n&&pe.hasOwnProperty(e))return s.log("Config: Found config file '"+e+"' in storage"),ve[e]=Promise.resolve(JSON.parse(pe.getItem(e)));var i=!1,o=function(t){return function(n){throw i||(s.log("Config: Error while "+t+" config file '"+e+"': "+n),i=!0),n}};return ve[e]=new Promise(function(t,n){s.log("Config: Loading config file '"+e+"'...");var i=new XMLHttpRequest;i.open("GET",e),i.responseType="text",i.addEventListener("load",function(){i.status<400?t(i.responseText):n(Error(i.statusText))}),i.send()})["catch"](o("loading")).then(M(t))["catch"](o("parsing")).then(function(t){return n&&pe.setItem(e,JSON.stringify(t)),t})["catch"](o("storing"))}function M(e){if("function"==typeof e)return e;switch(e){case T:case null:case"properties":return L;case"plain":return k;case"lines":return x;case"json":return JSON.parse}throw Error('Config: Unknown parser "'+e+"'")}function x(e){return e.split("\n").map(P).filter(k)}function L(e){var t,n,s={};return e.split("\n").map(P).forEach(function(e,i){if(""!==e)if(n=we.exec(e))s[n[1]]=JSON?JSON.parse(n[2]):n[2];else if(n=ye.exec(e))t=n[1],s.hasOwnProperty(t)||(s[t]=[]);else{if(!t)throw Error("Config: Syntax error on line "+(i+1)+" '"+e+"'");s[t].push(e)}}),s}function P(e){return _e.exec(e)[0]}function k(e){return e}function D(e){var n=i.getElementsByClassName("slideshow"),o=n.length?n[0]:i.body;e.grid&&"1x1"!==e.grid&&/^\d+x\d+$/.test(e.grid)?(s.log("initializing slideshow grid "+e.grid),t.slideshow=new $(o,e)):(s.log("initializing slideshow"),t.slideshow=new N(o,e))}function N(e,t){this.parent=e,this.parent.insertAdjacentHTML("afterbegin",Ce);var n=this.parent.getElementsByClassName("slideshow-layer"),s=this.parent.getElementsByClassName("slideshow-filename");this.layers=[];for(var i=0,o=n.length;o>i;++i)this.layers[i]=new O(this,n[i],s[i]);this.currentLayer=0,this.loader=new Image,this.loader.addEventListener("load",this._showCurrent.bind(this)),this.ctrlsElem=this.parent.getElementsByClassName("slideshow-controls")[0],t&&this.init(t),this._btn("next"),this._btn("prev"),this._btn("toggle")}function O(e,t,n){this.ss=e,this.elem=t,this.elemStyle=t.style,this.filenameElem=n}function $(e,t){var s,o=t.grid.split("x"),r=o[0],l=o[1];this.slideshows=[];for(var a=0;r>a;++a)for(var c=0;l>c;++c)s=i.createElement("div"),s.style.position="absolute",s.style.left=c/l*100+"%",s.style.top=a/r*100+"%",s.style.width=1/l*100+"%",s.style.height=1/r*100+"%",e.appendChild(s),this.slideshows.push(new N(s,n.extend(t,{interval_seconds:Math.round(1e3*(2.5+Math.random()*(2*(t.interval_seconds||Se.interval_seconds)-5)))/1e3})))}t="default"in t?t["default"]:t,n="default"in n?n["default"]:n,s="default"in s?s["default"]:s,i="default"in i?i["default"]:i;var T,H="MDModern",U="0.2.0",q="GPL-3.0+",A=n("#fade-in-cover");n(function(){t.setTimeout(function(){A.addClass("ready"),t.setTimeout(function(){A.remove()},1e3)},1500)});var z={},R=n(z),B=null,j=null,G=null,J=[],F=[],Q=[],W=!1,V=!0;z.on=n.fn.on.bind(R),z.one=n.fn.one.bind(R),z.on("passwordPrompt",function(){W=!0}).one("prompt",r),z.login=function(e,t){return o()&&(z.one("passwordPrompt",function(){z.one("prompt",r),a(t)}),l(e)),this},z.selectUser=function(e){return e=""+e,e!==B&&o()&&(z.one("prompt",r),l(e)),this},z.sendPassword=function(e){return o()&&(W?(z.one("prompt",r),a(e)):B&&(z.one("passwordPrompt",function(){z.one("prompt",r),a(e)}),l(B))),this},z.getUser=function(e){for(var t=0,n=J.length;n>t;++t)if(J[t].name===""+e)return J[t]},z.getSession=function(e){for(var t=0,n=F.length;n>t;++t)if(F[t].file===""+e)return F[t]},z.selectSession=function(e){return s.log("MDM: sending session info"),alert("SESSION###"+e.name+"###"+e.file),z},z.getLanguage=function(e){for(var t=0,n=Q.length;n>t;++t)if(Q[t].code===""+e)return Q[t]},z.selectLanguage=function(e){return s.log("MDM: sending language info"),alert("LANGUAGE###"+e.code),z},z.shutdown=function(){return s.log("MDM: sending force-shutdown request"),alert("FORCE-SHUTDOWN###"),z},z.restart=function(){return s.log("MDM: sending force-restart request"),alert("FORCE-RESTART###"),z},z.suspend=function(){return s.log("MDM: sending force-suspend request"),alert("FORCE-SUSPEND###"),z},z.quit=function(){return s.log("MDM: sending quit request"),alert("QUIT###"),z},d.prototype={toString:function(){return this.name},select:function(){return z.selectUser(this),this}},u.prototype={select:function(){return z.selectSession(this),this}},h.prototype={select:function(){return z.selectLanguage(this),this},countryCode:function(){return this.code.split(".")[0]},shortCode:function(){return this.code.split("_")[0]},charset:function(){return this.code.split(".")[1]}},t.mdm_enable=function(){c("enabled")},t.mdm_disable=function(){c("disabled")},t.mdm_prompt=function(){c("usernamePrompt"),c("prompt")},t.mdm_noecho=function(){c("passwordPrompt"),c("prompt")},t.mdm_add_user=function(e,t,n,s){var i=new d(e,t,n,s);J.push(i),c("userAdded",i)},t.mdm_add_session=function(e,t){var n=new u(e,t);F.push(n),c("sessionAdded",n)},t.mdm_add_language=function(e,t){var n=new h(e,t);Q.push(n),c("languageAdded",n)},t.mdm_set_current_user=function(e){e&&B!==e&&(B=e,c("userSelected",z.getUser(e)||new d(e)))},t.mdm_set_current_session=function(e,t){j!==t&&(j=t,c("sessionSelected",z.getSession(t)))},t.mdm_set_current_language=function(e,t){G!==t&&(G=t,c("languageSelected",z.getLanguage(t)))},t.mdm_error=function(e){e&&c("error",e)},t.mdm_msg=function(e){e&&c("message",e)},t.mdm_timed=function(e){c("timedMessage",e),c("loginCountdown",+e.match(/[0-9]+/)[0])},t.set_welcome_message=function(e){e&&c("welcomeMessage",e)},t.set_clock=function(e){c("clockUpdate",e)},t.mdm_hide_shutdown=function(){c("shutdownHidden")},t.mdm_hide_restart=function(){c("restartHidden")},t.mdm_hide_suspend=function(){c("suspendHidden")},t.mdm_hide_quit=function(){c("quitHidden")},t.mdm_hide_xdmcp=function(){c("xdmcpHidden")},["shutdown","restart","suspend","quit"].forEach(function(e){var t=n("#"+e);t.length&&(z.on(e+"Hidden",function(){t.hide()}),t.find("a").click(z[e]))});var X=n("#messages");z.on("error",f);var K=n("#countdown"),Y=n("#countdown-bar"),Z=-1;K.length&&z.on("loginCountdown",g),Y.length&&z.on("loginCountdown",m);var ee,te=n(document.body),ne=n("#login"),se=n("#username",ne),ie=n("#password",ne),oe=n("#face",ne)[0],re=[],le=n("#userlist-toggle",ne),ae=n("#users",ne),ce=!1;z.on("userAdded",v).on("userSelected",w).one("passwordPrompt",function(){ie.select()}),se.on("propertychange input paste",function(e){w(e,z.getUser(this.value))}),ne.submit(p);var de,ue=n("#session"),he=n("#sessions");z.on("sessionAdded",C).on("sessionSelected",S);var fe,ge=n("#language"),me=n("#languages");z.on("languageAdded",E).on("languageSelected",I);var pe=t.localStorage,ve=Object.create(null),we=/^(\S+)\s*=\s*(.*)$/,ye=/^\[(\S+)\]$/,_e=/^[^#"]*(:?"[^"]*"[^#"]*)*/,Ce='<div class="slideshow-layer"><span class="slideshow-filename"></span></div><div class="slideshow-layer"><span class="slideshow-filename"></span></div><span class="slideshow-controls"><a class="slideshow-prev"><i class="fa fa-chevron-left"></i></a><a class="slideshow-toggle"><i class="fa fa-play"></i></a><a class="slideshow-next"><i class="fa fa-chevron-right"></i></a></span>',Se={interval_seconds:10,fade_seconds:2,shuffle:!0,show_controls:!0,show_filename:!1,grid:null,fill_style:null,background_style:"#222"};N.prototype={init:function(e){return this.cfg=e=n.extend(Se,e),this.sources=e.backgrounds.slice(0),this.currentId=0,this.intervalId&&this.stop(),1===this.sources.length?(this.setImage(this.sources[0]),void(this.ctrlsElem.style.display="none")):(e.shuffle&&this.shuffle(),this.setImage(this.sources[0]).start(),e.show_controls?this.ctrlsElem.style.display=null:this.ctrlsElem.style.display="none",this)},_btn:function(e){var t=this.ctrlsElem.getElementsByClassName("slideshow-"+e);return t.length?(t[0].addEventListener("click",this[e].bind(this)),t[0]):void 0},setImage:function(e){return this.loader.src=e,this},_showCurrent:function(){return this.layers[this.currentLayer].hide(),this.currentLayer=(this.currentLayer+1)%this.layers.length,this.layers[this.currentLayer].show(this.loader),this},next:function(e){return e&&(e.defaultPrevented||e.preventDefault())||(this.currentId=(this.currentId+1)%this.sources.length,this.setImage(this.sources[this.currentId])),this},prev:function(e){return e&&(e.defaultPrevented||e.preventDefault())||(this.currentId=(this.currentId+this.sources.length-1)%this.sources.length,this.setImage(this.sources[this.currentId])),this},start:function(e){return e&&(e.defaultPrevented||e.preventDefault())||this.intervalId||(this.intervalId=t.setInterval(this.next.bind(this),1e3*this.cfg.interval_seconds),this.ctrlsElem.classList.add("slideshow-running")),this},stop:function(e){return e&&(e.defaultPrevented||e.preventDefault())||this.intervalId&&(t.clearInterval(this.intervalId),this.intervalId=!1,this.ctrlsElem.classList.remove("slideshow-running")),this},toggle:function(e){return this.intervalId?this.stop(e):this.start(e)},shuffle:function(){for(var e,t,n=this.sources,s=n.length;s--;)t=Math.floor(Math.random()*s),e=n[s],n[s]=n[t],n[t]=e;return this},openCurrent:function(){t.open(this.sources[this.currentId])}},O.prototype={show:function(e){var t=this.ss.cfg.fill_style?this.ss.cfg.fill_style:"50% 50% / "+this._getCssSizing(e)+" no-repeat";return this.elemStyle.background='url("'+e.src+'") '+t+","+this.ss.cfg.background_style,this.elemStyle.transition="z-index 0s "+this.ss.cfg.fade_seconds+"s",this.elemStyle.zIndex=1,this.elemStyle.opacity=1,this.elemStyle.visibility="visible",this.ss.cfg.show_filename&&(this.filenameElem.innerHTML=e.src),this},hide:function(){var e=this.ss.cfg.fade_seconds;return this.elemStyle.transition="opacity "+e+"s,z-index 0s "+e+"s,visibility 0s "+e+"s",this.elemStyle.zIndex=0,this.elemStyle.opacity=0,this.elemStyle.visibility="hidden",this},_getCssSizing:function(e){var t=this.elem.getBoundingClientRect(),n=t.bottom-t.top,s=t.right-t.left,i=e.naturalHeight,o=e.naturalWidth;return.6*n>i&&.6*s>o?"auto":i>=n&&o>=s?"cover":.7*n>i||.7*s>o||Math.abs(n/s-i/o)>.5?"contain":"cover"}},$.prototype={},Object.getOwnPropertyNames(N.prototype).forEach(function(e){"_"!==e[0]&&($.prototype[e]=function(){for(var t=0,n=this.slideshows.length;n>t;++t)this.slideshows[t][e]();return this})}),b("slideshow.conf",!1).then(D)["catch"](function(){s.log("failed to initialize slideshow")}),e.name=H,e.version=U,e.license=q}(this.MDModern=this.MDModern||{},window,jQuery,console,document);
//# sourceMappingURL=MDModern.js.map