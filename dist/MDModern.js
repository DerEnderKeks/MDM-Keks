!function(e,t,n,s,i){"use strict";function r(e,t){e in V?V[e].push(t):V[e]=[t]}function o(e,t){if(e in V)if(t)for(var n=V[e],s=0,i=n.length;i>s;++s){var r=n[s];if(r===t||r._fn===t){1===n.length?delete V[e]:n.splice(s,1);break}}else delete V[e]}function a(e,t){function n(e){o(e,n),t.call(this,e)}n._fn=t,r(e,n)}function l(e){for(var t,n=arguments.length,s=Array(n>1?n-1:0),i=1;n>i;i++)s[i-1]=arguments[i];if((t=console).log.apply(t,[e].concat(s)),e in V)for(var r=V[e].slice(),o=0,a=r.length;a>o;++o)r[o].apply(r,[e].concat(s))}function c(e,t){Y[e]=t}function u(e){delete Y[e]}function d(e){for(var t=arguments.length,n=Array(t>1?t-1:0),s=1;t>s;s++)n[s-1]=arguments[s];if(e in Y){var i=Y[e];if(u(e),!i.apply(F,[e].concat(n)))return}l.apply(F,[e].concat(n))}function h(){this._items=[],this._running=!1}function f(e,t,n,s){return n&&(p(n),s&&v(s)),re.user&&re.user===(e.id||e)||m(e),g(t)}function g(e){if(!e)return Promise.reject("Password required!");if(!re.user)return Promise.reject("Please chose a login name!");var t=ce(re);return ae.push(function(){var n=Q.asyncToGenerator(regeneratorRuntime.mark(function s(n){var i,r,o;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(t.user===oe.user&&le){s.next=3;break}return s.next=3,m(t.user);case 3:"session"in t&&t.session!==oe.session&&(i=w(t.session),alert("SESSION###"+i.name+"###"+i.file)),"language"in t&&t.language!==oe.language&&(r=_(t.language),alert("LANGUAGE###"+r.code)),o=void 0,c("error",function(e,t){return o=t}),c("passwordPrompt",function(){return n(o),!0}),le=!1,alert("LOGIN###"+e);case 10:case"end":return s.stop()}},s,this)}));return function(e){return n.apply(this,arguments)}}())}function m(e){return e=y(e),re.user=e.id,ae.push(function(t){c("userSelected",function(){c("passwordPrompt",function(){return t(e),!0})}),alert("USER###"+e.name)})}function p(e){return e=w(e),re.session=e.id,l("sessionSelected",e),Promise.resolve(e)}function v(e){return e=_(e),re.language=e.id,l("languageSelected",e),Promise.resolve(e)}function y(e){return e=e.id||e,ne.find(function(t){return t.id===e})}function w(e){return e=e.id||e,se.find(function(t){return t.id===e})}function _(e){return e=e.id||e,ie.find(function(t){return t.id===e})}function C(){return alert("FORCE-SHUTDOWN###"),this}function b(){return alert("FORCE-RESTART###"),this}function S(){return alert("FORCE-SUSPEND###"),this}function E(){return alert("QUIT###"),this}function I(){t.setTimeout(function(){var e=n("#fade-in-cover");e.addClass("ready"),t.setTimeout(function(){e.remove()},1e3),t.clearTimeout(de),o("ready",I)},1500)}function x(e){var t=k(e,"pending");ge.push(t)}function k(e,t){var s=t in fe?'<i class="fa fa-fw '+fe[t]+'"></i>':"",i=n('<li class="message">'+(s+e)+"</li>");return he.append(i.fadeIn()).animate({scrollTop:he.height()},500),i}function P(e,t){me.text(t)}function O(e,t){t>ve&&(ve=t,pe.addClass("running")),pe.css({width:100*t/ve+"%"})}function L(e){e.preventDefault(),x("checking..."),f(_e[0].value,Ce[0].value),Ce.select()}function j(e,t){var s=n("<li>"),i=n("<a>"+t.name+"</a>"),r=n('<i class="fa fa-user">'),o=new Image;Ie.append(s.append(i.prepend(r))),t.loggedIn&&s.addClass("loggedIn"),i.click(function(e){M(e,t)}),o.loaded=!1,o.src=t.facefile,n(o).one("load",function(){r.remove(),i.prepend(o),o.loaded=!0}),t.$li=s,t.img=o,Se.push(t),1===Se.length&&Ee.one("click",N),ke||(ke=t)}function M(e,t){ke.$li.removeClass("selected"),T(t),t&&t.$li&&(_e.is(e.target)||t.name===_e[0].value||_e.val(t.name),t.$li&&t.$li.addClass("selected"),ke=t)}function T(e){we.removeClass("hasface"),e&&e.img&&(e.img.loaded?(be.src=e.img.src,we.addClass("hasface")):n(e.img).one("load",function(){e===ke&&(be.src=e.img.src,we.addClass("hasface"))}))}function N(e){xe?(ye.off("click",N),Ee.one("click",N)):(ye.click(N),e.stopPropagation()),Ie.toggleClass("expanded"),xe=!xe}function $(e,t){t.$li=n("<li>").append(n("<a>"+t.name+"</a>").click(t.select.bind(t))),Oe.append(t.$li),Le||(Le=t)}function A(e,t){Le.$li.removeClass("selected"),Pe.html(t.name),t.$li.addClass("selected"),Le=t}function D(e,t){t.$li=n("<li>").append(n('<a>\n          <span class="code">'+t.countryCode()+'</span>\n          <span class="name">'+t.name+"</span>\n        </a>").click(t.select.bind(t))),Me.append(t.$li),Te||(Te=t)}function H(e,t){Te.$li.removeClass("selected"),je.html(t.shortCode()),t.$li.addClass("selected"),Te=t}function R(e,t,n){if(e in $e)return $e[e];if("boolean"==typeof t&&(n=t,t=F),n=Ne&&(n===F||n),n&&Ne.hasOwnProperty(e))return s.log("Config: Found config file '"+e+"' in storage"),$e[e]=Promise.resolve(JSON.parse(Ne.getItem(e)));var i=!1,r=function(t){return function(n){throw i||(s.log("Config: Error while "+t+" config file '"+e+"': "+n),i=!0),n}};return $e[e]=new Promise(function(t,n){s.log("Config: Loading config file '"+e+"'...");var i=new XMLHttpRequest;i.open("GET",e),i.responseType="text",i.addEventListener("load",function(){i.status<400?t(i.responseText):n(Error(i.statusText))}),i.send()})["catch"](r("loading")).then(z(t))["catch"](r("parsing")).then(function(t){return n&&Ne.setItem(e,JSON.stringify(t)),t})["catch"](r("storing"))}function z(e){if("function"==typeof e)return e;switch(e){case F:case null:case"properties":return U;case"plain":return Ue;case"lines":return Re;case"json":return JSON.parse}throw Error('Config: Unknown parser "'+e+"'")}function U(e){var t={},n=void 0,s=void 0;return e.split("\n").map(ze).forEach(function(e,i){if(""!==e)if(s=Ae.exec(e))t[s[1]]=JSON?JSON.parse(s[2]):s[2];else if(s=De.exec(e))n=s[1],t.hasOwnProperty(n)||(t[n]=[]);else{if(!n)throw Error("Config: Syntax error on line "+(i+1)+" '"+e+"'");t[n].push(e)}}),t}function G(e){var n=i.getElementsByClassName("slideshow"),r=n.length?n[0]:i.body;e.grid&&"1x1"!==e.grid&&/^\d+x\d+$/.test(e.grid)?(s.log("initializing slideshow grid "+e.grid),t.slideshow=new J(r,e)):(s.log("initializing slideshow"),t.slideshow=new q(r,e))}function q(e,t){this.parent=e,this.parent.insertAdjacentHTML("afterbegin",Ge);var n=this.parent.getElementsByClassName("slideshow-layer"),s=this.parent.getElementsByClassName("slideshow-filename");this.layers=[];for(var i=0,r=n.length;r>i;++i)this.layers[i]=new B(this,n[i],s[i]);this.currentLayer=0,this.loader=new Image,this.loader.addEventListener("load",this._showCurrent.bind(this)),this.ctrlsElem=this.parent.getElementsByClassName("slideshow-controls")[0],t&&this.init(t),this._btn("next"),this._btn("prev"),this._btn("toggle")}function B(e,t,n){this.ss=e,this.elem=t,this.elemStyle=t.style,this.filenameElem=n}function J(e,t){var s=t.grid.split("x"),r=s[0],o=s[1],a=void 0;this.slideshows=[];for(var l=0;r>l;++l)for(var c=0;o>c;++c)a=i.createElement("div"),a.style.position="absolute",a.style.left=c/o*100+"%",a.style.top=l/r*100+"%",a.style.width=1/o*100+"%",a.style.height=1/r*100+"%",e.appendChild(a),this.slideshows.push(new q(a,n.extend(t,{interval_seconds:Math.round(1e3*(2.5+Math.random()*(2*(t.interval_seconds||qe.interval_seconds)-5)))/1e3})))}t="default"in t?t["default"]:t,n="default"in n?n["default"]:n,s="default"in s?s["default"]:s,i="default"in i?i["default"]:i;var F,Q={};Q.asyncToGenerator=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function s(i,r){try{var o=t[i](r),a=o.value}catch(l){return void n(l)}return o.done?void e(a):Promise.resolve(a).then(function(e){return s("next",e)},function(e){return s("throw",e)})}return s("next")})}},Q.classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Q.createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}();var W="MDModern",X="0.2.0",K="GPL-3.0+",V=Object.create(null),Y=Object.create(null),Z=function(){function e(t,n,s,i){Q.classCallCheck(this,e),this.id=t,this.name=t,this.gecos=n,this.loggedIn=s||!1,this.facefile=i||"file:///home/"+t+"/.face"}return Q.createClass(e,[{key:"select",value:function(){return m(this),this}}]),e}(),ee=function(){function e(t,n){Q.classCallCheck(this,e),this.id=n,this.name=t,this.file=n}return Q.createClass(e,[{key:"select",value:function(){return p(this),this}}]),e}(),te=function(){function e(t,n){Q.classCallCheck(this,e),this.id=n,this.name=t,this.code=n}return Q.createClass(e,[{key:"select",value:function(){return v(this),this}},{key:"countryCode",value:function(){return this.code.split(".")[0]}},{key:"shortCode",value:function(){return this.code.split("_")[0]}},{key:"charset",value:function(){return this.code.split(".")[1]}}]),e}();h.prototype={push:function(e){var t=this,n=new Promise(function(n,s){return t._items.push({callback:e,resolve:n,reject:s})});return this._start(),n},_start:function(){this._running||(this._running=!0,this._next())},_next:function(){if(!this._items.length)return void(this._running=!1);var e=this._items.shift(),t=this;new Promise(e.callback).then(function(){e.resolve.apply(e,arguments),t._next()},function(){e.reject.apply(e,arguments),t._next()})}};var ne=[],se=[],ie=[],re=Object.create(null),oe=Object.create(null),ae=new h,le=!1,ce=function(e){return Object.assign(Object.create(Object.getPrototypeOf(e)),e)};t.mdm_add_user=function(e,t,n,s){var i=new Z(e,t,n,s);ne.push(i),d("userAdded",i)},t.mdm_add_session=function(e,t){var n=new ee(e,t);se.push(n),d("sessionAdded",n)},t.mdm_add_language=function(e,t){var n=new te(e,t);ie.push(n),d("languageAdded",n)},t.mdm_set_current_user=function(e){if(!e&&re.user)return c("usernamePrompt",function(){return!1}),c("prompt",function(){return!1}),void alert("USER###"+re.user);var t=y(e)||new Z(e);oe.user=t.id,d("userSelected",t)},t.mdm_set_current_session=function(e,t){var n=w(t)||new ee(e,t);oe.session=n.id,d("sessionSelected",n)},t.mdm_set_current_language=function(e,t){var n=_(t)||new te(e,t);oe.language=n.id,d("languageSelected",n)},t.mdm_prompt=function(e){le=!1,d("prompt",e),d("usernamePrompt",e)},t.mdm_noecho=function(e){le=!0,d("prompt",e),d("passwordPrompt",e)},t.mdm_enable=function(){d("enabled")},t.mdm_disable=function(){d("disabled")},t.mdm_error=function(e){e&&d("error",e)},t.mdm_hide_shutdown=function(){l("shutdownHidden")},t.mdm_hide_restart=function(){l("restartHidden")},t.mdm_hide_suspend=function(){l("suspendHidden")},t.mdm_hide_quit=function(){l("quitHidden")},t.mdm_hide_xdmcp=function(){l("xdmcpHidden")},t.mdm_msg=function(e){e&&l("message",e)},t.mdm_timed=function(e){l("timedMessage",e),l("loginCountdown",+e.match(/[0-9]+/)[0])},t.set_welcome_message=function(e){e&&l("welcomeMessage",e)},t.set_clock=function(e){l("clockUpdate",e)},a("prompt",function(){return l("ready")});var ue=Object.freeze({addEventListener:r,on:r,removeEventListener:o,off:o,once:a,one:a,login:f,sendPassword:g,selectUser:m,selectSession:p,selectLanguage:v,getUser:y,getSession:w,getLanguage:_,shutdown:C,restart:b,suspend:S,quit:E});r("ready",I);var de=t.setTimeout(function(){console.log("MDM ready timeout"),I()},3e3);["shutdown","restart","suspend","quit"].forEach(function(e){var t=n("#"+e);t.length&&(r(e+"Hidden",function(){t.hide()}),t.find("a").click(ue[e]))});var he=n("#messages"),fe={error:"fa-exclamation",pending:"fa-spinner fa-spin"},ge=[];r("error",function(e,t){if(t){var n=e.type||e;if(ge.length){var s=n in fe?'<i class="fa fa-fw '+fe[n]+'"></i>':"";ge.shift().html(s+t)}else k(t,n)}});var me=n("#countdown"),pe=n("#countdown-bar"),ve=-1;me.length&&r("loginCountdown",P),pe.length&&r("loginCountdown",O);var ye=n(document.body),we=n("#login"),_e=n("#username",we),Ce=n("#password",we),be=n("#face",we)[0],Se=[],Ee=n("#userlist-toggle",we),Ie=n("#users",we),xe=!1,ke=void 0;r("userAdded",j),r("userSelected",M),a("passwordPrompt",function(){Ce.select()}),_e.on("propertychange input paste",function(e){M(e,y(this.value))}),we.submit(L);var Pe=n("#session"),Oe=n("#sessions"),Le=void 0;r("sessionAdded",$),r("sessionSelected",A);var je=n("#language"),Me=n("#languages"),Te=void 0;r("languageAdded",D),r("languageSelected",H);var Ne=t.localStorage,$e=Object.create(null),Ae=/^(\S+)\s*=\s*(.*)$/,De=/^\[(\S+)\]$/,He=/^[^#"]*(:?"[^"]*"[^#"]*)*/,Re=function(e){return e.split("\n").map(ze).filter(Ue)},ze=function(e){return He.exec(e)[0]},Ue=function(e){return e},Ge='<div class="slideshow-layer"><span class="slideshow-filename"></span></div><div class="slideshow-layer"><span class="slideshow-filename"></span></div><span class="slideshow-controls"><a class="slideshow-prev"><i class="fa fa-chevron-left"></i></a><a class="slideshow-toggle"><i class="fa fa-play"></i></a><a class="slideshow-next"><i class="fa fa-chevron-right"></i></a></span>',qe={interval_seconds:10,fade_seconds:2,shuffle:!0,show_controls:!0,show_filename:!1,grid:null,fill_style:null,background_style:"#222"};q.prototype={init:function(e){return this.cfg=e=n.extend(qe,e),this.sources=e.backgrounds.slice(0),this.currentId=0,this.intervalId&&this.stop(),1===this.sources.length?(this.setImage(this.sources[0]),void(this.ctrlsElem.style.display="none")):(e.shuffle&&this.shuffle(),this.setImage(this.sources[0]).start(),e.show_controls?this.ctrlsElem.style.display=null:this.ctrlsElem.style.display="none",this)},_btn:function(e){var t=this.ctrlsElem.getElementsByClassName("slideshow-"+e);return t.length?(t[0].addEventListener("click",this[e].bind(this)),t[0]):void 0},setImage:function(e){return this.loader.src=e,this},_showCurrent:function(){return this.layers[this.currentLayer].hide(),this.currentLayer=(this.currentLayer+1)%this.layers.length,this.layers[this.currentLayer].show(this.loader),this},next:function(e){return e&&(e.defaultPrevented||e.preventDefault())||(this.currentId=(this.currentId+1)%this.sources.length,this.setImage(this.sources[this.currentId])),this},prev:function(e){return e&&(e.defaultPrevented||e.preventDefault())||(this.currentId=(this.currentId+this.sources.length-1)%this.sources.length,this.setImage(this.sources[this.currentId])),this},start:function(e){return e&&(e.defaultPrevented||e.preventDefault())||this.intervalId||(this.intervalId=t.setInterval(this.next.bind(this),1e3*this.cfg.interval_seconds),this.ctrlsElem.classList.add("slideshow-running")),this},stop:function(e){return e&&(e.defaultPrevented||e.preventDefault())||this.intervalId&&(t.clearInterval(this.intervalId),this.intervalId=!1,this.ctrlsElem.classList.remove("slideshow-running")),this},toggle:function(e){return this.intervalId?this.stop(e):this.start(e)},shuffle:function(){for(var e=this.sources,t=e.length,n=void 0,s=void 0;t--;)s=Math.floor(Math.random()*t),n=e[t],e[t]=e[s],e[s]=n;return this},openCurrent:function(){t.open(this.sources[this.currentId])}},B.prototype={show:function(e){var t=this.ss.cfg.fill_style?this.ss.cfg.fill_style:"50% 50% / "+this._getCssSizing(e)+" no-repeat";return this.elemStyle.background='url("'+e.src+'") '+t+","+this.ss.cfg.background_style,this.elemStyle.transition="z-index 0s "+this.ss.cfg.fade_seconds+"s",this.elemStyle.zIndex=1,this.elemStyle.opacity=1,this.elemStyle.visibility="visible",this.ss.cfg.show_filename&&(this.filenameElem.innerHTML=e.src),this},hide:function(){var e=this.ss.cfg.fade_seconds;return this.elemStyle.transition="opacity "+e+"s,z-index 0s "+e+"s,visibility 0s "+e+"s",this.elemStyle.zIndex=0,this.elemStyle.opacity=0,this.elemStyle.visibility="hidden",this},_getCssSizing:function(e){var t=this.elem.getBoundingClientRect(),n=t.bottom-t.top,s=t.right-t.left,i=e.naturalHeight,r=e.naturalWidth;return.6*n>i&&.6*s>r?"auto":i>=n&&r>=s?"cover":.7*n>i||.7*s>r||Math.abs(n/s-i/r)>.5?"contain":"cover"}},J.prototype={},Object.getOwnPropertyNames(q.prototype).forEach(function(e){"_"!==e[0]&&(J.prototype[e]=function(){for(var t=0,n=this.slideshows.length;n>t;++t)this.slideshows[t][e]();return this})}),R("slideshow.conf",!1).then(G)["catch"](function(){s.log("failed to initialize slideshow")}),e.name=W,e.version=X,e.license=K}(this.MDModern=this.MDModern||{},window,jQuery,console,document);
//# sourceMappingURL=MDModern.js.map