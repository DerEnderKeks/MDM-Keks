!function(e,t,n,s,i){"use strict";function r(e,t){e in ee?ee[e].push(t):ee[e]=[t]}function o(e,t){if(e in ee)if(t)for(var n=ee[e],s=0,i=n.length;i>s;++s){var r=n[s];if(r===t||r._fn===t){1===n.length?delete ee[e]:n.splice(s,1);break}}else delete ee[e]}function a(e,t){function n(e){o(e,n),t.call(this,e)}n._fn=t,r(e,n)}function l(e){for(var t,n=arguments.length,s=Array(n>1?n-1:0),i=1;n>i;i++)s[i-1]=arguments[i];if((t=console).log.apply(t,[e].concat(s)),e in ee)for(var r=ee[e].slice(),o=0,a=r.length;a>o;++o)r[o].apply(r,[e].concat(s))}function c(e,t){te[e]=t}function u(e){delete te[e]}function d(e){for(var t=arguments.length,n=Array(t>1?t-1:0),s=1;t>s;s++)n[s-1]=arguments[s];if(e in te){var i=te[e];if(u(e),!i.apply(X,[e].concat(n)))return}l.apply(X,[e].concat(n))}function h(e,t,n,s){this.id=e,this.name=e,this.gecos=t,this.loggedIn=n||!1,this.facefile=s||"file:///home/"+e+"/.face"}function f(e,t){this.id=t,this.name=e,this.file=t}function g(e,t){this.id=t,this.name=e,this.code=t}function p(){this._items=[],this._running=!1}function m(e,t,n,s){return n&&(w(n),s&&_(s)),re.user&&re.user===(e.id||e)||y(e),v(t)}function v(e){if(!e)return Promise.reject("Password required!");if(!re.user)return Promise.reject("Please chose a login name!");var t=ce(re);return ae.push(function(){var n=K.asyncToGenerator(regeneratorRuntime.mark(function s(n){var i,r,o;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(t.user===oe.user&&le){s.next=3;break}return s.next=3,y(t.user);case 3:"session"in t&&t.session!==oe.session&&(i=S(t.session),alert("SESSION###"+i.name+"###"+i.file)),"language"in t&&t.language!==oe.language&&(r=C(t.language),alert("LANGUAGE###"+r.code)),o=void 0,c("error",function(e,t){return o=t}),c("passwordPrompt",function(){return n(o),!0}),le=!1,alert("LOGIN###"+e);case 10:case"end":return s.stop()}},s,this)}));return function(e){return n.apply(this,arguments)}}())}function y(e){return e=b(e),re.user=e.id,ae.push(function(t){c("userSelected",function(){c("passwordPrompt",function(){return t(e),!0})}),alert("USER###"+e.name)})}function w(e){return e=S(e),re.session=e.id,l("sessionSelected",e),Promise.resolve(e)}function _(e){return e=C(e),re.language=e.id,l("languageSelected",e),Promise.resolve(e)}function b(e){return e=e.id||e,ne.find(function(t){return t.id===e})}function S(e){return e=e.id||e,se.find(function(t){return t.id===e})}function C(e){return e=e.id||e,ie.find(function(t){return t.id===e})}function E(){return alert("FORCE-SHUTDOWN###"),this}function I(){return alert("FORCE-RESTART###"),this}function x(){return alert("FORCE-SUSPEND###"),this}function P(){return alert("QUIT###"),this}function O(){t.setTimeout(function(){var e=n("#fade-in-cover");e.addClass("ready"),t.setTimeout(function(){e.remove()},1e3),t.clearTimeout(de),o("ready",O)},1500)}function k(e){var t=L(e,"pending");ge.push(t)}function L(e,t){var s=t in fe?'<i class="fa fa-fw '+fe[t]+'"></i>':"",i=n('<li class="message">'+(s+e)+"</li>");return he.append(i.fadeIn()).animate({scrollTop:he.height()},500),i}function M(e,t){pe.text(t)}function j(e,t){t>ve&&(ve=t,me.addClass("running")),me.css({width:100*t/ve+"%"})}function T(e){e.preventDefault(),k("checking..."),m(_e[0].value,be[0].value),be.select()}function N(e,t){var s=n("<li>"),i=n("<a>"+t.name+"</a>"),r=n('<i class="fa fa-user">'),o=new Image;Ie.append(s.append(i.prepend(r))),t.loggedIn&&s.addClass("loggedIn"),i.click(function(e){$(e,t)}),o.loaded=!1,o.src=t.facefile,n(o).one("load",function(){r.remove(),i.prepend(o),o.loaded=!0}),t.$li=s,t.img=o,Ce.push(t),1===Ce.length&&Ee.one("click",D),Pe||(Pe=t)}function $(e,t){Pe.$li.removeClass("selected"),A(t),t&&t.$li&&(_e.is(e.target)||t.name===_e[0].value||_e.val(t.name),t.$li&&t.$li.addClass("selected"),Pe=t)}function A(e){we.removeClass("hasface"),e&&e.img&&(e.img.loaded?(Se.src=e.img.src,we.addClass("hasface")):n(e.img).one("load",function(){e===Pe&&(Se.src=e.img.src,we.addClass("hasface"))}))}function D(e){xe?(ye.off("click",D),Ee.one("click",D)):(ye.click(D),e.stopPropagation()),Ie.toggleClass("expanded"),xe=!xe}function H(e,t){t.$li=n("<li>").append(n("<a>"+t.name+"</a>").click(t.select.bind(t))),ke.append(t.$li),Le||(Le=t)}function R(e,t){Le.$li.removeClass("selected"),Oe.html(t.name),t.$li.addClass("selected"),Le=t}function z(e,t){t.$li=n("<li>").append(n('<a>\n          <span class="code">'+t.countryCode()+'</span>\n          <span class="name">'+t.name+"</span>\n        </a>").click(t.select.bind(t))),je.append(t.$li),Te||(Te=t)}function U(e,t){Te.$li.removeClass("selected"),Me.html(t.shortCode()),t.$li.addClass("selected"),Te=t}function G(e,t,n){if(e in $e)return $e[e];if("boolean"==typeof t&&(n=t,t=X),n=Ne&&(n===X||n),n&&Ne.hasOwnProperty(e))return s.log("Config: Found config file '"+e+"' in storage"),$e[e]=Promise.resolve(JSON.parse(Ne.getItem(e)));var i=!1,r=function(t){return function(n){throw i||(s.log("Config: Error while "+t+" config file '"+e+"': "+n),i=!0),n}};return $e[e]=new Promise(function(t,n){s.log("Config: Loading config file '"+e+"'...");var i=new XMLHttpRequest;i.open("GET",e),i.responseType="text",i.addEventListener("load",function(){i.status<400?t(i.responseText):n(Error(i.statusText))}),i.send()})["catch"](r("loading")).then(q(t))["catch"](r("parsing")).then(function(t){return n&&Ne.setItem(e,JSON.stringify(t)),t})["catch"](r("storing"))}function q(e){if("function"==typeof e)return e;switch(e){case X:case null:case"properties":return B;case"plain":return Ue;case"lines":return Re;case"json":return JSON.parse}throw Error('Config: Unknown parser "'+e+"'")}function B(e){var t={},n=void 0,s=void 0;return e.split("\n").map(ze).forEach(function(e,i){if(""!==e)if(s=Ae.exec(e))t[s[1]]=JSON?JSON.parse(s[2]):s[2];else if(s=De.exec(e))n=s[1],t.hasOwnProperty(n)||(t[n]=[]);else{if(!n)throw Error("Config: Syntax error on line "+(i+1)+" '"+e+"'");t[n].push(e)}}),t}function J(e){var n=i.getElementsByClassName("slideshow"),r=n.length?n[0]:i.body;e.grid&&"1x1"!==e.grid&&/^\d+x\d+$/.test(e.grid)?(s.log("initializing slideshow grid "+e.grid),t.slideshow=new W(r,e)):(s.log("initializing slideshow"),t.slideshow=new F(r,e))}function F(e,t){this.parent=e,this.parent.insertAdjacentHTML("afterbegin",Ge);var n=this.parent.getElementsByClassName("slideshow-layer"),s=this.parent.getElementsByClassName("slideshow-filename");this.layers=[];for(var i=0,r=n.length;r>i;++i)this.layers[i]=new Q(this,n[i],s[i]);this.currentLayer=0,this.loader=new Image,this.loader.addEventListener("load",this._showCurrent.bind(this)),this.ctrlsElem=this.parent.getElementsByClassName("slideshow-controls")[0],t&&this.init(t),this._btn("next"),this._btn("prev"),this._btn("toggle")}function Q(e,t,n){this.ss=e,this.elem=t,this.elemStyle=t.style,this.filenameElem=n}function W(e,t){var s=t.grid.split("x"),r=s[0],o=s[1],a=void 0;this.slideshows=[];for(var l=0;r>l;++l)for(var c=0;o>c;++c)a=i.createElement("div"),a.style.position="absolute",a.style.left=c/o*100+"%",a.style.top=l/r*100+"%",a.style.width=1/o*100+"%",a.style.height=1/r*100+"%",e.appendChild(a),this.slideshows.push(new F(a,n.extend(t,{interval_seconds:Math.round(1e3*(2.5+Math.random()*(2*(t.interval_seconds||qe.interval_seconds)-5)))/1e3})))}t="default"in t?t["default"]:t,n="default"in n?n["default"]:n,s="default"in s?s["default"]:s,i="default"in i?i["default"]:i;var X,K={};K.asyncToGenerator=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function s(i,r){try{var o=t[i](r),a=o.value}catch(l){return void n(l)}return o.done?void e(a):Promise.resolve(a).then(function(e){return s("next",e)},function(e){return s("throw",e)})}return s("next")})}};var V="MDModern",Y="0.2.0",Z="GPL-3.0+",ee=Object.create(null),te=Object.create(null);h.prototype={select:function(){return y(this),this}},f.prototype={select:function(){return w(this),this}},g.prototype={select:function(){return _(this),this},countryCode:function(){return this.code.split(".")[0]},shortCode:function(){return this.code.split("_")[0]},charset:function(){return this.code.split(".")[1]}},p.prototype={push:function(e){var t=this,n=new Promise(function(n,s){return t._items.push({callback:e,resolve:n,reject:s})});return this._start(),n},_start:function(){this._running||(this._running=!0,this._next())},_next:function(){if(!this._items.length)return void(this._running=!1);var e=this._items.shift(),t=this;new Promise(e.callback).then(function(){e.resolve.apply(e,arguments),t._next()},function(){e.reject.apply(e,arguments),t._next()})}};var ne=[],se=[],ie=[],re=Object.create(null),oe=Object.create(null),ae=new p,le=!1,ce=function(e){return Object.assign(Object.create(Object.getPrototypeOf(e)),e)};t.mdm_add_user=function(e,t,n,s){var i=new h(e,t,n,s);ne.push(i),d("userAdded",i)},t.mdm_add_session=function(e,t){var n=new f(e,t);se.push(n),d("sessionAdded",n)},t.mdm_add_language=function(e,t){var n=new g(e,t);ie.push(n),d("languageAdded",n)},t.mdm_set_current_user=function(e){if(!e&&re.user)return c("usernamePrompt",function(){return!1}),c("prompt",function(){return!1}),void alert("USER###"+re.user);var t=b(e)||new h(e);oe.user=t.id,d("userSelected",t)},t.mdm_set_current_session=function(e,t){var n=S(t)||new f(e,t);oe.session=n.id,d("sessionSelected",n)},t.mdm_set_current_language=function(e,t){var n=C(t)||new g(e,t);oe.language=n.id,d("languageSelected",n)},t.mdm_prompt=function(e){le=!1,d("prompt",e),d("usernamePrompt",e)},t.mdm_noecho=function(e){le=!0,d("prompt",e),d("passwordPrompt",e)},t.mdm_enable=function(){d("enabled")},t.mdm_disable=function(){d("disabled")},t.mdm_error=function(e){e&&d("error",e)},t.mdm_hide_shutdown=function(){l("shutdownHidden")},t.mdm_hide_restart=function(){l("restartHidden")},t.mdm_hide_suspend=function(){l("suspendHidden")},t.mdm_hide_quit=function(){l("quitHidden")},t.mdm_hide_xdmcp=function(){l("xdmcpHidden")},t.mdm_msg=function(e){e&&l("message",e)},t.mdm_timed=function(e){l("timedMessage",e),l("loginCountdown",+e.match(/[0-9]+/)[0])},t.set_welcome_message=function(e){e&&l("welcomeMessage",e)},t.set_clock=function(e){l("clockUpdate",e)},a("prompt",function(){return l("ready")});var ue=Object.freeze({addEventListener:r,on:r,removeEventListener:o,off:o,once:a,one:a,login:m,sendPassword:v,selectUser:y,selectSession:w,selectLanguage:_,getUser:b,getSession:S,getLanguage:C,shutdown:E,restart:I,suspend:x,quit:P});r("ready",O);var de=t.setTimeout(function(){console.log("MDM ready timeout"),O()},3e3);["shutdown","restart","suspend","quit"].forEach(function(e){var t=n("#"+e);t.length&&(r(e+"Hidden",function(){t.hide()}),t.find("a").click(ue[e]))});var he=n("#messages"),fe={error:"fa-exclamation",pending:"fa-spinner fa-spin"},ge=[];r("error",function(e,t){if(t){var n=e.type||e;if(ge.length){var s=n in fe?'<i class="fa fa-fw '+fe[n]+'"></i>':"";ge.shift().html(s+t)}else L(t,n)}});var pe=n("#countdown"),me=n("#countdown-bar"),ve=-1;pe.length&&r("loginCountdown",M),me.length&&r("loginCountdown",j);var ye=n(document.body),we=n("#login"),_e=n("#username",we),be=n("#password",we),Se=n("#face",we)[0],Ce=[],Ee=n("#userlist-toggle",we),Ie=n("#users",we),xe=!1,Pe=void 0;r("userAdded",N),r("userSelected",$),a("passwordPrompt",function(){be.select()}),_e.on("propertychange input paste",function(e){$(e,b(this.value))}),we.submit(T);var Oe=n("#session"),ke=n("#sessions"),Le=void 0;r("sessionAdded",H),r("sessionSelected",R);var Me=n("#language"),je=n("#languages"),Te=void 0;r("languageAdded",z),r("languageSelected",U);var Ne=t.localStorage,$e=Object.create(null),Ae=/^(\S+)\s*=\s*(.*)$/,De=/^\[(\S+)\]$/,He=/^[^#"]*(:?"[^"]*"[^#"]*)*/,Re=function(e){return e.split("\n").map(ze).filter(Ue)},ze=function(e){return He.exec(e)[0]},Ue=function(e){return e},Ge='<div class="slideshow-layer"><span class="slideshow-filename"></span></div><div class="slideshow-layer"><span class="slideshow-filename"></span></div><span class="slideshow-controls"><a class="slideshow-prev"><i class="fa fa-chevron-left"></i></a><a class="slideshow-toggle"><i class="fa fa-play"></i></a><a class="slideshow-next"><i class="fa fa-chevron-right"></i></a></span>',qe={interval_seconds:10,fade_seconds:2,shuffle:!0,show_controls:!0,show_filename:!1,grid:null,fill_style:null,background_style:"#222"};F.prototype={init:function(e){return this.cfg=e=n.extend(qe,e),this.sources=e.backgrounds.slice(0),this.currentId=0,this.intervalId&&this.stop(),1===this.sources.length?(this.setImage(this.sources[0]),void(this.ctrlsElem.style.display="none")):(e.shuffle&&this.shuffle(),this.setImage(this.sources[0]).start(),e.show_controls?this.ctrlsElem.style.display=null:this.ctrlsElem.style.display="none",this)},_btn:function(e){var t=this.ctrlsElem.getElementsByClassName("slideshow-"+e);return t.length?(t[0].addEventListener("click",this[e].bind(this)),t[0]):void 0},setImage:function(e){return this.loader.src=e,this},_showCurrent:function(){return this.layers[this.currentLayer].hide(),this.currentLayer=(this.currentLayer+1)%this.layers.length,this.layers[this.currentLayer].show(this.loader),this},next:function(e){return e&&(e.defaultPrevented||e.preventDefault())||(this.currentId=(this.currentId+1)%this.sources.length,this.setImage(this.sources[this.currentId])),this},prev:function(e){return e&&(e.defaultPrevented||e.preventDefault())||(this.currentId=(this.currentId+this.sources.length-1)%this.sources.length,this.setImage(this.sources[this.currentId])),this},start:function(e){return e&&(e.defaultPrevented||e.preventDefault())||this.intervalId||(this.intervalId=t.setInterval(this.next.bind(this),1e3*this.cfg.interval_seconds),this.ctrlsElem.classList.add("slideshow-running")),this},stop:function(e){return e&&(e.defaultPrevented||e.preventDefault())||this.intervalId&&(t.clearInterval(this.intervalId),this.intervalId=!1,this.ctrlsElem.classList.remove("slideshow-running")),this},toggle:function(e){return this.intervalId?this.stop(e):this.start(e)},shuffle:function(){for(var e=this.sources,t=e.length,n=void 0,s=void 0;t--;)s=Math.floor(Math.random()*t),n=e[t],e[t]=e[s],e[s]=n;return this},openCurrent:function(){t.open(this.sources[this.currentId])}},Q.prototype={show:function(e){var t=this.ss.cfg.fill_style?this.ss.cfg.fill_style:"50% 50% / "+this._getCssSizing(e)+" no-repeat";return this.elemStyle.background='url("'+e.src+'") '+t+","+this.ss.cfg.background_style,this.elemStyle.transition="z-index 0s "+this.ss.cfg.fade_seconds+"s",this.elemStyle.zIndex=1,this.elemStyle.opacity=1,this.elemStyle.visibility="visible",this.ss.cfg.show_filename&&(this.filenameElem.innerHTML=e.src),this},hide:function(){var e=this.ss.cfg.fade_seconds;return this.elemStyle.transition="opacity "+e+"s,z-index 0s "+e+"s,visibility 0s "+e+"s",this.elemStyle.zIndex=0,this.elemStyle.opacity=0,this.elemStyle.visibility="hidden",this},_getCssSizing:function(e){var t=this.elem.getBoundingClientRect(),n=t.bottom-t.top,s=t.right-t.left,i=e.naturalHeight,r=e.naturalWidth;return.6*n>i&&.6*s>r?"auto":i>=n&&r>=s?"cover":.7*n>i||.7*s>r||Math.abs(n/s-i/r)>.5?"contain":"cover"}},W.prototype={},Object.getOwnPropertyNames(F.prototype).forEach(function(e){"_"!==e[0]&&(W.prototype[e]=function(){for(var t=0,n=this.slideshows.length;n>t;++t)this.slideshows[t][e]();return this})}),G("slideshow.conf",!1).then(J)["catch"](function(){s.log("failed to initialize slideshow")}),e.name=V,e.version=Y,e.license=Z}(this.MDModern=this.MDModern||{},window,jQuery,console,document);
//# sourceMappingURL=MDModern.js.map