!function(e,t,n,s,i){"use strict";function o(){return F?!1:(F=!0,c("locked"),!0)}function r(){return F?(F=!1,c("unlocked"),!0):!1}function l(e){s.log("MDM: sending username"),alert("USER###"+e)}function a(e){s.log("MDM: sending password"),J=!1,alert("LOGIN###"+e)}function c(e,t){s.log("EVENT: "+e,t),q.triggerHandler(e,t)}function d(e,t,n,s){this.name=e,this.gecos=t,this.loggedIn=n||!1,this.facefile=s||"file:///home/"+e+"/.face"}function u(e,t){this.name=e,this.file=t}function h(e,t){this.name=e,this.code=t}function f(e,t){if(t){var s=n('<li class="message">'+t+"</li>");Q.append(s.fadeIn()).animate({scrollTop:Q.height()},500)}}function g(e,t){W.text(t)}function m(e,t){t>X&&(X=t,V.addClass("running")),V.css({width:100*t/X+"%"})}function p(e){e.preventDefault(),U.login(Z[0].value,ee[0].value),ee.select()}function v(e,t){var s=n("<li>"),i=n("<a>"+t.name+"</a>"),o=n('<i class="fa fa-user">'),r=new Image;ie.append(s.append(i.prepend(o))),t.loggedIn&&s.addClass("loggedIn"),i.click(function(e){w(e,t)}),r.loaded=!1,r.src=t.facefile,n(r).one("load",function(){o.remove(),i.prepend(r),r.loaded=!0}),t.$li=s,t.img=r,ne.push(t),1===ne.length&&se.one("click",_),re||(re=t)}function w(e,t){re.$li.removeClass("selected"),y(t),t&&t.$li&&(Z.is(e.target)||t.name===Z[0].value||Z.val(t.name),t.$li&&t.$li.addClass("selected"),re=t)}function y(e){Y.removeClass("hasface"),e&&e.img&&(e.img.loaded?(te.src=e.img.src,Y.addClass("hasface")):n(e.img).one("load",function(){e==re&&(te.src=e.img.src),Y.addClass("hasface")}))}function _(e){oe?(K.off("click",_),se.one("click",_)):(K.click(_),e.stopPropagation()),ie.toggleClass("expanded"),oe=!oe}function C(e,t){t.$li=n(document.createElement("li")).append(n("<a>"+t.name+"</a>").click(t.select.bind(t))),ae.append(t.$li),ce||(ce=t)}function S(e,t){ce.$li.removeClass("selected"),le.html(t.name),t.$li.addClass("selected"),ce=t}function E(e,t){t.$li=n(document.createElement("li")).append(n('<a><span class="code">'+t.countryCode()+'</span><span class="name">'+t.name+"</span></a>").click(t.select.bind(t))),ue.append(t.li),he||(he=t)}function I(e,t){he.$li.removeClass("selected"),de.html(t.shortCode()),t.$li.addClass("selected"),he=t}function b(e,t,n){if(e in ge)return ge[e];if("boolean"==typeof t&&(n=t,t=N),n=fe&&(n===N||n),n&&fe.hasOwnProperty(e))return s.log("Config: Found config file '"+e+"' in storage"),ge[e]=Promise.resolve(JSON.parse(fe.getItem(e)));var i=!1,o=function(t){return function(n){throw i||(s.log("Config: Error while "+t+" config file '"+e+"': "+n),i=!0),n}};return ge[e]=new Promise(function(t,n){s.log("Config: Loading config file '"+e+"'...");var i=new XMLHttpRequest;i.open("GET",e),i.responseType="text",i.addEventListener("load",function(){i.status<400?t(i.responseText):n(Error(i.statusText))}),i.send()})["catch"](o("loading")).then(M(t))["catch"](o("parsing")).then(function(t){return n&&fe.setItem(e,JSON.stringify(t)),t})["catch"](o("storing"))}function M(e){if("function"==typeof e)return e;switch(e){case N:case null:case"properties":return x;case"plain":return _e;case"lines":return we;case"json":return JSON.parse}throw Error('Config: Unknown parser "'+e+"'")}function x(e){var t={},n=void 0,s=void 0;return e.split("\n").map(ye).forEach(function(e,i){if(""!==e)if(s=me.exec(e))t[s[1]]=JSON?JSON.parse(s[2]):s[2];else if(s=pe.exec(e))n=s[1],t.hasOwnProperty(n)||(t[n]=[]);else{if(!n)throw Error("Config: Syntax error on line "+(i+1)+" '"+e+"'");t[n].push(e)}}),t}function L(e){var n=i.getElementsByClassName("slideshow"),o=n.length?n[0]:i.body;e.grid&&"1x1"!==e.grid&&/^\d+x\d+$/.test(e.grid)?(s.log("initializing slideshow grid "+e.grid),t.slideshow=new D(o,e)):(s.log("initializing slideshow"),t.slideshow=new P(o,e))}function P(e,t){this.parent=e,this.parent.insertAdjacentHTML("afterbegin",Ce);var n=this.parent.getElementsByClassName("slideshow-layer"),s=this.parent.getElementsByClassName("slideshow-filename");this.layers=[];for(var i=0,o=n.length;o>i;++i)this.layers[i]=new k(this,n[i],s[i]);this.currentLayer=0,this.loader=new Image,this.loader.addEventListener("load",this._showCurrent.bind(this)),this.ctrlsElem=this.parent.getElementsByClassName("slideshow-controls")[0],t&&this.init(t),this._btn("next"),this._btn("prev"),this._btn("toggle")}function k(e,t,n){this.ss=e,this.elem=t,this.elemStyle=t.style,this.filenameElem=n}function D(e,t){var s=t.grid.split("x"),o=s[0],r=s[1],l=void 0;this.slideshows=[];for(var a=0;o>a;++a)for(var c=0;r>c;++c)l=i.createElement("div"),l.style.position="absolute",l.style.left=c/r*100+"%",l.style.top=a/o*100+"%",l.style.width=1/r*100+"%",l.style.height=1/o*100+"%",e.appendChild(l),this.slideshows.push(new P(l,n.extend(t,{interval_seconds:Math.round(1e3*(2.5+Math.random()*(2*(t.interval_seconds||Se.interval_seconds)-5)))/1e3})))}t="default"in t?t["default"]:t,n="default"in n?n["default"]:n,s="default"in s?s["default"]:s,i="default"in i?i["default"]:i;var N,O="MDModern",$="0.2.0",T="GPL-3.0+",H=n("#fade-in-cover");n(function(){t.setTimeout(function(){H.addClass("ready"),t.setTimeout(function(){H.remove()},1e3)},1500)});var U={},q=n(U),A=[],z=[],R=[],B=null,j=null,G=null,J=!1,F=!0;U.on=n.fn.on.bind(q),U.one=n.fn.one.bind(q),U.on("passwordPrompt",function(){J=!0}).one("prompt",r),U.login=function(e,t){return o()&&(U.one("passwordPrompt",function(){U.one("prompt",r),a(t)}),l(e)),this},U.selectUser=function(e){return e=""+e,e!==B&&o()&&(U.one("prompt",r),l(e)),this},U.sendPassword=function(e){return o()&&(J?(U.one("prompt",r),a(e)):B&&(U.one("passwordPrompt",function(){U.one("prompt",r),a(e)}),l(B))),this},U.getUser=function(e){for(var t=0,n=A.length;n>t;++t)if(A[t].name===""+e)return A[t]},U.getSession=function(e){for(var t=0,n=z.length;n>t;++t)if(z[t].file===""+e)return z[t]},U.selectSession=function(e){return s.log("MDM: sending session info"),alert("SESSION###"+e.name+"###"+e.file),U},U.getLanguage=function(e){for(var t=0,n=R.length;n>t;++t)if(R[t].code===""+e)return R[t]},U.selectLanguage=function(e){return s.log("MDM: sending language info"),alert("LANGUAGE###"+e.code),U},U.shutdown=function(){return s.log("MDM: sending force-shutdown request"),alert("FORCE-SHUTDOWN###"),U},U.restart=function(){return s.log("MDM: sending force-restart request"),alert("FORCE-RESTART###"),U},U.suspend=function(){return s.log("MDM: sending force-suspend request"),alert("FORCE-SUSPEND###"),U},U.quit=function(){return s.log("MDM: sending quit request"),alert("QUIT###"),U},d.prototype={toString:function(){return this.name},select:function(){return U.selectUser(this),this}},u.prototype={select:function(){return U.selectSession(this),this}},h.prototype={select:function(){return U.selectLanguage(this),this},countryCode:function(){return this.code.split(".")[0]},shortCode:function(){return this.code.split("_")[0]},charset:function(){return this.code.split(".")[1]}},t.mdm_enable=function(){c("enabled")},t.mdm_disable=function(){c("disabled")},t.mdm_prompt=function(){c("usernamePrompt"),c("prompt")},t.mdm_noecho=function(){c("passwordPrompt"),c("prompt")},t.mdm_add_user=function(e,t,n,s){var i=new d(e,t,n,s);A.push(i),c("userAdded",i)},t.mdm_add_session=function(e,t){var n=new u(e,t);z.push(n),c("sessionAdded",n)},t.mdm_add_language=function(e,t){var n=new h(e,t);R.push(n),c("languageAdded",n)},t.mdm_set_current_user=function(e){e&&B!==e&&(B=e,c("userSelected",U.getUser(e)||new d(e)))},t.mdm_set_current_session=function(e,t){j!==t&&(j=t,c("sessionSelected",U.getSession(t)))},t.mdm_set_current_language=function(e,t){G!==t&&(G=t,c("languageSelected",U.getLanguage(t)))},t.mdm_error=function(e){e&&c("error",e)},t.mdm_msg=function(e){e&&c("message",e)},t.mdm_timed=function(e){c("timedMessage",e),c("loginCountdown",+e.match(/[0-9]+/)[0])},t.set_welcome_message=function(e){e&&c("welcomeMessage",e)},t.set_clock=function(e){c("clockUpdate",e)},t.mdm_hide_shutdown=function(){c("shutdownHidden")},t.mdm_hide_restart=function(){c("restartHidden")},t.mdm_hide_suspend=function(){c("suspendHidden")},t.mdm_hide_quit=function(){c("quitHidden")},t.mdm_hide_xdmcp=function(){c("xdmcpHidden")},["shutdown","restart","suspend","quit"].forEach(function(e){var t=n("#"+e);t.length&&(U.on(e+"Hidden",function(){t.hide()}),t.find("a").click(U[e]))});var Q=n("#messages");U.on("error",f);var W=n("#countdown"),V=n("#countdown-bar"),X=-1;W.length&&U.on("loginCountdown",g),V.length&&U.on("loginCountdown",m);var K=n(document.body),Y=n("#login"),Z=n("#username",Y),ee=n("#password",Y),te=n("#face",Y)[0],ne=[],se=n("#userlist-toggle",Y),ie=n("#users",Y),oe=!1,re=void 0;U.on("userAdded",v).on("userSelected",w).one("passwordPrompt",function(){ee.select()}),Z.on("propertychange input paste",function(e){w(e,U.getUser(this.value))}),Y.submit(p);var le=n("#session"),ae=n("#sessions"),ce=void 0;U.on("sessionAdded",C).on("sessionSelected",S);var de=n("#language"),ue=n("#languages"),he=void 0;U.on("languageAdded",E).on("languageSelected",I);var fe=t.localStorage,ge=Object.create(null),me=/^(\S+)\s*=\s*(.*)$/,pe=/^\[(\S+)\]$/,ve=/^[^#"]*(:?"[^"]*"[^#"]*)*/,we=function(e){return e.split("\n").map(ye).filter(_e)},ye=function(e){return ve.exec(e)[0]},_e=function(e){return e},Ce='<div class="slideshow-layer"><span class="slideshow-filename"></span></div><div class="slideshow-layer"><span class="slideshow-filename"></span></div><span class="slideshow-controls"><a class="slideshow-prev"><i class="fa fa-chevron-left"></i></a><a class="slideshow-toggle"><i class="fa fa-play"></i></a><a class="slideshow-next"><i class="fa fa-chevron-right"></i></a></span>',Se={interval_seconds:10,fade_seconds:2,shuffle:!0,show_controls:!0,show_filename:!1,grid:null,fill_style:null,background_style:"#222"};P.prototype={init:function(e){return this.cfg=e=n.extend(Se,e),this.sources=e.backgrounds.slice(0),this.currentId=0,this.intervalId&&this.stop(),1===this.sources.length?(this.setImage(this.sources[0]),void(this.ctrlsElem.style.display="none")):(e.shuffle&&this.shuffle(),this.setImage(this.sources[0]).start(),e.show_controls?this.ctrlsElem.style.display=null:this.ctrlsElem.style.display="none",this)},_btn:function(e){var t=this.ctrlsElem.getElementsByClassName("slideshow-"+e);return t.length?(t[0].addEventListener("click",this[e].bind(this)),t[0]):void 0},setImage:function(e){return this.loader.src=e,this},_showCurrent:function(){return this.layers[this.currentLayer].hide(),this.currentLayer=(this.currentLayer+1)%this.layers.length,this.layers[this.currentLayer].show(this.loader),this},next:function(e){return e&&(e.defaultPrevented||e.preventDefault())||(this.currentId=(this.currentId+1)%this.sources.length,this.setImage(this.sources[this.currentId])),this},prev:function(e){return e&&(e.defaultPrevented||e.preventDefault())||(this.currentId=(this.currentId+this.sources.length-1)%this.sources.length,this.setImage(this.sources[this.currentId])),this},start:function(e){return e&&(e.defaultPrevented||e.preventDefault())||this.intervalId||(this.intervalId=t.setInterval(this.next.bind(this),1e3*this.cfg.interval_seconds),this.ctrlsElem.classList.add("slideshow-running")),this},stop:function(e){return e&&(e.defaultPrevented||e.preventDefault())||this.intervalId&&(t.clearInterval(this.intervalId),this.intervalId=!1,this.ctrlsElem.classList.remove("slideshow-running")),this},toggle:function(e){return this.intervalId?this.stop(e):this.start(e)},shuffle:function(){for(var e=this.sources,t=e.length,n=void 0,s=void 0;t--;)s=Math.floor(Math.random()*t),n=e[t],e[t]=e[s],e[s]=n;return this},openCurrent:function(){t.open(this.sources[this.currentId])}},k.prototype={show:function(e){var t=this.ss.cfg.fill_style?this.ss.cfg.fill_style:"50% 50% / "+this._getCssSizing(e)+" no-repeat";return this.elemStyle.background='url("'+e.src+'") '+t+","+this.ss.cfg.background_style,this.elemStyle.transition="z-index 0s "+this.ss.cfg.fade_seconds+"s",this.elemStyle.zIndex=1,this.elemStyle.opacity=1,this.elemStyle.visibility="visible",this.ss.cfg.show_filename&&(this.filenameElem.innerHTML=e.src),this},hide:function(){var e=this.ss.cfg.fade_seconds;return this.elemStyle.transition="opacity "+e+"s,z-index 0s "+e+"s,visibility 0s "+e+"s",this.elemStyle.zIndex=0,this.elemStyle.opacity=0,this.elemStyle.visibility="hidden",this},_getCssSizing:function(e){var t=this.elem.getBoundingClientRect(),n=t.bottom-t.top,s=t.right-t.left,i=e.naturalHeight,o=e.naturalWidth;return.6*n>i&&.6*s>o?"auto":i>=n&&o>=s?"cover":.7*n>i||.7*s>o||Math.abs(n/s-i/o)>.5?"contain":"cover"}},D.prototype={},Object.getOwnPropertyNames(P.prototype).forEach(function(e){"_"!==e[0]&&(D.prototype[e]=function(){for(var t=0,n=this.slideshows.length;n>t;++t)this.slideshows[t][e]();return this})}),b("slideshow.conf",!1).then(L)["catch"](function(){s.log("failed to initialize slideshow")}),e.name=O,e.version=$,e.license=T}(this.MDModern=this.MDModern||{},window,jQuery,console,document);
//# sourceMappingURL=MDModern.js.map